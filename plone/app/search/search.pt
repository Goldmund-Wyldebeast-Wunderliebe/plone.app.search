<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<head>
  <metal:block metal:fill-slot="head_slot">
  <!-- XXX FIX XXX -->

    <link rel="alternate" title="RSS 1.0" type="application/rss+xml"
          tal:define="here_url
          context/@@plone_context_state/object_url;"
          tal:condition="request/SearchableText|nothing"
          tal:attributes="href string:$here_url/search_rss?${request/QUERY_STRING}"/>
  </metal:block>

  <metal:block fill-slot="top_slot"
               tal:define="dummy python:request.set('disable_border',1);
			               disable_column_one python:request.set('disable_plone.leftcolumn',1);
			               disable_column_two python:request.set('disable_plone.rightcolumn',1);" />
</head>

<body>

  <div metal:fill-slot="main" tal:define="results view/results;
       Batch python:modules['Products.CMFPlone'].Batch;
       b_size python:30;b_start python:0;b_start request/b_start | b_start;">

    <form name="searchform" 
          action="@@search"
          class="searchPage enableAutoFocus">
      
        <input class="searchPage"
               name="SearchableText"
               type="text"
               size="25"
               title="Search Site"
               i18n:attributes="title title_search_title;"
               tal:attributes="value request/SearchableText|nothing;"
               />
        <input class="searchPage searchButton"
               type="submit"
               value="Search"
               i18n:attributes="value label_search;"/>

        <div class="search-advanced">
          <div id="hide-form" style="display:none;">
            <p class="moreSearchOptions">
              <a href=""
                 tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/search_form?${request/QUERY_STRING}">
                More search options
              </a>
            </p>
            <!-- <metal:use use-macro="context/search_form/macros/form" /> -->
         </div>
         <div id="show-form">
            <p class="moreSearchOptions">
              <a href=""
                 tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/search_form?${request/QUERY_STRING}">
                More search options
              </a>
            </p>
        </div>
        
        <script type="text/javascript">
           search_form_filter = '#content-core';        
           function noformerrorshow(el, noform) {
               var o = jq(el);
               var emsg = o.find('dl.portalMessage.error');
               if (emsg.length) {
                   o.children().replaceWith(emsg);
                   return false;
               } else {
                   return noform;
               }
           }
           jq('#show-form a').prepOverlay(
               {
                   subtype: 'ajax',
                   filter: search_form_filter,
                   formselector: '#content-core',
                   noform: function(el) {return noformerrorshow(el, 'reload');},
                   closeselector: '[name=form.button.Cancel]'
               }
           );
        </script>

    </form>

    <h1 class="documentFirstHeading">
      <span i18n:translate="heading_search_results">
        Search results
      </span>
      <span class="discreet">
        &mdash;
        <span i18n:translate="batch_x_items_matching_your_criteria"
        ><span i18n:name="number" 
        tal:omit-tag="" 
        tal:content="python:len(results)">234</span> items matching your search terms</span>
      </span>
    </h1>

    <p class="discreet"
       tal:condition="context/portal_syndication/isSiteSyndicationAllowed">
      <a href=""
         class="link-feed"
         tal:define="here_url context/@@plone_context_state/object_url"
         tal:attributes="href string:$here_url/search_rss?${request/QUERY_STRING}">
	<img src="" alt="RSS"
	     tal:attributes="src string:${portal_url}/rss.gif"/>
	<span i18n:translate="title_rss_feed">
	  Subscribe to an always-updated RSS feed of these search terms
	</span>
      </a>
    </p>

    <div tal:condition="not: results">
      <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
    </div>

    <p tal:condition="results">
      <span i18n:translate="sort_by">Sort by</span><span tal:repeat="item view/getSortOptions">
        <a tal:condition="not:item/selected" tal:content="item/title" tal:attributes="href item/url"></a>
        <strong tal:condition="item/selected" tal:content="item/title"></strong> <span tal:condition="not:repeat/item/end">&middot;</span>
      </span>
    </p>

    <div tal:condition="results" tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1)">
      <dl class="searchResults" tal:define="toLocalizedTime nocall: context/@@plone/toLocalizedTime">
      <tal:results repeat="item batch">
      <tal:entry>
        <dt tal:attributes="class item/ContentTypeClass">
          <img tal:replace="structure item/getIcon" />
          <a href="#" 
             tal:attributes="href string:${item/getURL}${item/appendViewAction};
                             class string:state-${item/review_state}"
             tal:content="item/Title" />
        </dt>
        <dd>
          <span class="discreet"
            tal:condition="python:not context.portal_membership.isAnonymousUser() or site_properties.allowAnonymousViewAbout">
            <span class="documentAuthor" tal:define="author item/Creator"
                  i18n:translate="label_by_author">
              by
              <a href="#"
                 tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/author/${author/username}"
                 tal:content="python:author['fullname'] or author['username']"
                 i18n:name="author">
                Bob Dobalina
              </a>
            </span>
            
            <span tal:define="publication_date item/EffectiveDate;
                              modification_date item/ModificationDate">

                <span class="documentPublished" tal:condition="python: publication_date != 'None'">
                  &mdash;
                  <span i18n:translate="box_published">
                    published
                  </span>
                  <span tal:replace="python:toLocalizedTime(publication_date, long_format=0)">
                    August 16, 2001 at 23:35:59
                  </span>
                </span>

                <span class="documentModified" tal:condition="python: modification_date != publication_date">
                  &mdash;
                  <span i18n:translate="box_last_modified">
                    last modified
                  </span>
                  <span tal:replace="python:toLocalizedTime(modification_date, long_format=1)">
                    August 16, 2001 at 23:35:59
                  </span>
                </span>

            </span>

            <span tal:define="categories item/Subject|nothing"
                  tal:condition="categories">
              &mdash;
              <tal:filedunder i18n:translate="label_filed_under">filed under:</tal:filedunder>
              <span tal:repeat="category categories">
                <a href=""
                   class="link-category"
                   rel="tag"
                   tal:content="category"
                   tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/search?Subject%3Alist=${category}">
                  Category
                </a><tal:separator condition="not: repeat/category/end">,</tal:separator>
              </span>
            </span>
          </span>
          <div tal:content="item/CroppedDescription">
            Cropped description
          </div>

          <cite class="documentLocation link-location"
                tal:define="url item/getURL;
                            truncated_url python: view.truncate_url(url);"
               tal:content="structure truncated_url">
              Location
          </cite>
        </dd>

        </tal:entry>
        </tal:results>
      </dl>

      <div metal:use-macro="context/batch_macros/macros/navigation" />
    </div>
  </div>
</body>
</html>




